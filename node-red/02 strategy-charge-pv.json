[{"id":"676ceac4c521834d","type":"tab","label":"Strategy Charge PV v4.4.2","disabled":false,"info":"","env":[]},{"id":"9889d591bcc38e89","type":"group","z":"676ceac4c521834d","name":"Battery solutions","style":{"label":true},"nodes":["87be4b85f89829b6","d62d870eb44d3582"],"x":624,"y":79,"w":192,"h":142},{"id":"72059e541379a869","type":"group","z":"676ceac4c521834d","name":"Start","style":{"label":true},"nodes":["a5e9e484430e1720","bf548077ba6ca350","be2a48e071dee195"],"x":14,"y":79,"w":192,"h":162},{"id":"6e6682265db1e9ee","type":"group","z":"676ceac4c521834d","name":"Unhandled exceptions","style":{"label":true,"stroke":"#d88a8a","color":"#d88a8a"},"nodes":["524b61f06ac20ae7","b068ce351aa5b926","0d26b7f936be7947"],"x":14,"y":259,"w":182,"h":82},{"id":"a5e9e484430e1720","type":"link in","z":"676ceac4c521834d","g":"72059e541379a869","name":"Charge PV","links":[],"x":100,"y":160,"wires":[["be2a48e071dee195"]],"l":true},{"id":"13aeb5c39ba83e0a","type":"comment","z":"676ceac4c521834d","name":"Home Battery Strategy","info":"The `Home Battery Start` flow will call this strategy flow\nby matching the strategy name with the Link In name.\n\nConfigure the Link In node in the Start group.\n\nDon\u0027t modify other parts of the Start and End groups.\nThey handle the calling and returning for you.","x":120,"y":40,"wires":[]},{"id":"bf548077ba6ca350","type":"comment","z":"676ceac4c521834d","g":"72059e541379a869","name":"Start (readme)","info":"# Setting up your battery strategy flow\n\n## Setup\nName the `Link In node` in this start group exactly after the \u003cselect\u003e option configured in your\nselect_input.house_battery_strategy\n\nconfigure select options in:\ninput_select_house_battery_control.yaml\n\n### example\n`house_battery_strategy:\n  name: House Battery Strategy\n  options:\n    - AcmE example`\n\nThe above creates a select option, allowing user to select \u0027AcmE example\u0027\n\nWhen selected, battery control will search for a flow containing a Link In node\ncalled \u0027AcmE example\u0027 (case sensitive).","x":110,"y":120,"wires":[]},{"id":"87be4b85f89829b6","type":"link out","z":"676ceac4c521834d","g":"9889d591bcc38e89","name":"Return","mode":"return","links":[],"x":665,"y":180,"wires":[]},{"id":"d62d870eb44d3582","type":"comment","z":"676ceac4c521834d","g":"9889d591bcc38e89","name":"End (readme)","info":"Should return a solution_array of battery objects\n\n## battery object format\n`{{id: string|number, mode: string, power: number}} battery solution`\n- id is an arbitrary battery ID\n- mode is \"stop\", \"charge\", \"discharge\" for Marstek\n- power in Watts\n\n### example array\nreturn this type of solution_array via msg.solutions\n` \nlet solution_array = [];\nsolution_array.push({id:\"M1\", mode: \"charge\", power: 100}); // per battery\nreturn {solutions: solution_array};\n` ","x":720,"y":120,"wires":[]},{"id":"682972c51f2870ed","type":"function","z":"676ceac4c521834d","name":"Setup","func":"// explain\nconst log = global.get(\"logger\");\nlog(this,\"Using self-consumption to charge with surplus PV\")\n\n// use the self consumption strategy to charge when there is PV surplus\nmsg.target = \"Self-consumption\";\n\n// tell that strategy to disalow discharging\nconst DISABLE_DISCHARGE = true;\nRED.util.setMessageProperty(msg,\"advanced_settings.discharge_disabled\",DISABLE_DISCHARGE,true);\n\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":310,"y":180,"wires":[["17645a134fe6d941"]]},{"id":"17645a134fe6d941","type":"link call","z":"676ceac4c521834d","name":"Self-consumption","links":[],"linkType":"dynamic","timeout":"5","x":470,"y":180,"wires":[["d612533a5317bb76","87be4b85f89829b6"]]},{"id":"d612533a5317bb76","type":"debug","z":"676ceac4c521834d","name":"Batteries charging?","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"batteries_charging","targetType":"msg","statusVal":"payload","statusType":"auto","x":730,"y":260,"wires":[]},{"id":"be2a48e071dee195","type":"change","z":"676ceac4c521834d","g":"72059e541379a869","name":"Trace","rules":[{"t":"set","p":"strategy.trace","pt":"msg","to":"[\t   strategy.trace,\t   {\t       \"flow\": target,\t       \"flow_settings\": advanced_settings,\t       \"timestamp\": $now()\t   } \t]","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":90,"y":200,"wires":[["682972c51f2870ed"]],"info":"Attaches a breadcrumb trace to the msg\r\nso the user can reconstruct which route has\r\nbeen traveled"},{"id":"524b61f06ac20ae7","type":"catch","z":"676ceac4c521834d","g":"6e6682265db1e9ee","name":"","scope":null,"uncaught":false,"x":55,"y":300,"wires":[["b068ce351aa5b926"]],"l":false},{"id":"b068ce351aa5b926","type":"function","z":"676ceac4c521834d","g":"6e6682265db1e9ee","name":"Unhandled Exception","func":"const handle = global.get(\u0027unhandledException\u0027);\n\nhandle(this);\n\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":105,"y":300,"wires":[["0d26b7f936be7947"]],"l":false},{"id":"0d26b7f936be7947","type":"link out","z":"676ceac4c521834d","g":"6e6682265db1e9ee","name":"link out 4","mode":"return","links":[],"x":155,"y":300,"wires":[]}]
